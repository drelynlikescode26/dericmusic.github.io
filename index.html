<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deric — Official</title>
    <meta property="og:title" content="Deric — Official">
    <meta property="og:site_name" content="Deric">
    <meta name="twitter:title" content="Deric — Official">
    <meta property="og:description" content="Producer // Artist // Visionary">
    <meta name="twitter:description" content="Producer // Artist // Visionary">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="hero.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="hero-bg"></div>
    <div class="grain-overlay"></div>
    <button class="minimal-mode-toggle" id="minimalToggle" title="Toggle Minimal Mode (M)">◐</button>
    <div class="hud-panel">
        <div class="artist-block">
            <h1>DERIC</h1>
        </div>
        <div class="hud-links">
            <a href="https://open.spotify.com/artist/08nIFJLOyYWc5eWJCa4S8X" class="music-link spotify" title="Spotify" target="_blank" rel="noopener"><i class="fab fa-spotify"></i></a>
            <a href="https://music.apple.com/us/artist/deric/1529542054" class="music-link apple" title="Apple Music" target="_blank" rel="noopener"><i class="fab fa-apple"></i></a>
            <a href="https://on.soundcloud.com/Sp7ba1spJzejJtwVZi" class="music-link soundcloud" title="SoundCloud" target="_blank" rel="noopener"><i class="fab fa-soundcloud"></i></a>
            <a href="https://www.instagram.com/envyderic/" class="music-link instagram" title="Instagram" target="_blank" rel="noopener"><i class="fab fa-instagram"></i></a>
            <a href="https://www.tiktok.com/@ihatederic" class="music-link tiktok" title="TikTok" target="_blank" rel="noopener"><i class="fab fa-tiktok"></i></a>
            <a href="https://youtube.com/@envyderic" class="music-link youtube" title="YouTube" target="_blank" rel="noopener"><i class="fab fa-youtube"></i></a>
        </div>
        <div class="hud-actions">
            <button class="mode-trigger" id="listenTrigger">Listen</button>
            <button class="mode-trigger" id="watchTrigger">Watch</button>
        </div>
        <form class="email-capture" id="emailForm">
            <input type="email" placeholder="Stay tapped in." required id="emailInput">
            <button type="submit">→</button>
        </form>
    </div>
        <script>
        // Wait for DOM to fully load
        document.addEventListener('DOMContentLoaded', function() {
            // YouTube API Configuration
            const YOUTUBE_API_KEY = 'AIzaSyCsbg4IqmFkgteGXWOTu5B4N13QXh2ugkQ';
            const CHANNEL_ID = 'UCvMVDYpt5z-5MCPyIMtlT9A';
            const CACHE_KEY = 'youtube_videos_cache';
            const CACHE_DURATION = 3600000; // 1 hour in milliseconds
            
            // Elements
            const listenTrigger = document.getElementById('listenTrigger');
            const listenOverlay = document.getElementById('listenModeOverlay');
            const listenContent = document.getElementById('listenModeContent');
            const listenClose = document.getElementById('listenModeClose');
            const watchTrigger = document.getElementById('watchTrigger');
            const watchOverlay = document.getElementById('watchModeOverlay');
            const watchContent = document.getElementById('watchModeContent');
            const watchClose = document.getElementById('watchModeClose');
            const watchCarousel = document.getElementById('watchCarousel');
            const watchArrowLeft = document.getElementById('watchArrowLeft');
            const watchArrowRight = document.getElementById('watchArrowRight');
            const heroBg = document.querySelector('.hero-bg');
            const hudPanel = document.querySelector('.hud-panel');
            
            let listenModeActive = false;
            let watchModeActive = false;
            let videosLoaded = false;
            let currentVideoIndex = 0;
            let totalVideos = 0;
            
            // YouTube API Functions
            function getCachedVideos() {
                try {
                    const cache = localStorage.getItem(CACHE_KEY);
                    if (!cache) return null;
                    
                    const { timestamp, videos } = JSON.parse(cache);
                    const now = Date.now();
                    
                    if (now - timestamp < CACHE_DURATION) {
                        return videos;
                    }
                    return null;
                } catch (e) {
                    return null;
                }
            }
            
            function cacheVideos(videos) {
                try {
                    const cache = {
                        timestamp: Date.now(),
                        videos: videos
                    };
                    localStorage.setItem(CACHE_KEY, JSON.stringify(cache));
                } catch (e) {
                    console.warn('Could not cache videos');
                }
            }
            
            async function fetchYouTubeVideos() {
                // Check cache first
                const cached = getCachedVideos();
                if (cached) {
                    return cached;
                }
                
                // Fetch from API (get more results to filter)
                const url = `https://www.googleapis.com/youtube/v3/search?key=${YOUTUBE_API_KEY}&channelId=${CHANNEL_ID}&part=snippet,id&order=date&maxResults=15&type=video`;
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('API request failed');
                    
                    const data = await response.json();
                    const videos = data.items.map(item => ({
                        id: item.id.videoId,
                        title: item.snippet.title,
                        thumbnail: item.snippet.thumbnails.high.url,
                        publishedAt: item.snippet.publishedAt
                    }));
                    
                    // Get video statistics and duration to filter out Shorts
                    const videoIds = videos.map(v => v.id).join(',');
                    const statsUrl = `https://www.googleapis.com/youtube/v3/videos?key=${YOUTUBE_API_KEY}&id=${videoIds}&part=statistics,contentDetails`;
                    const statsResponse = await fetch(statsUrl);
                    const statsData = await statsResponse.json();
                    
                    // Filter out Shorts (videos under 90 seconds) and merge stats
                    const filteredVideos = [];
                    videos.forEach((video, index) => {
                        const videoData = statsData.items[index];
                        if (videoData) {
                            // Parse duration (ISO 8601 format like PT1M30S)
                            const duration = videoData.contentDetails.duration;
                            const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
                            const hours = parseInt(match[1] || 0);
                            const minutes = parseInt(match[2] || 0);
                            const seconds = parseInt(match[3] || 0);
                            const totalSeconds = hours * 3600 + minutes * 60 + seconds;
                            
                            // Only include videos 90 seconds or longer (exclude Shorts)
                            if (totalSeconds >= 90) {
                                filteredVideos.push(video);
                            }
                        }
                    });
                    
                    // Return only first 5 filtered videos
                    const finalVideos = filteredVideos.slice(0, 5);
                    cacheVideos(finalVideos);
                    return finalVideos;
                } catch (error) {
                    console.error('Failed to fetch YouTube videos:', error);
                    return [];
                }
            }
            
            function formatTimeAgo(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const seconds = Math.floor((now - date) / 1000);
                
                if (seconds < 60) return 'just now';
                if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
                if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
                if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;
                if (seconds < 2592000) return `${Math.floor(seconds / 604800)}w ago`;
                return `${Math.floor(seconds / 2592000)}mo ago`;
            }
            
            function renderVideos(videos) {
                watchCarousel.innerHTML = '';
                totalVideos = videos.length;
                currentVideoIndex = 0;
                
                if (videos.length === 0) {
                    watchCarousel.innerHTML = '<div class="watch-loading">No videos available</div>';
                    return;
                }
                
                videos.forEach(video => {
                    const card = document.createElement('div');
                    card.className = 'video-card';
                    card.innerHTML = `
                        <div class="video-thumbnail">
                            <img src="${video.thumbnail}" alt="${video.title}">
                        </div>
                        <div class="video-info">
                            <h3 class="video-title">${video.title}</h3>
                        </div>
                    `;
                    
                    card.addEventListener('click', () => {
                        openVideoModal(video.id);
                    });
                    
                    watchCarousel.appendChild(card);
                });
                
                updateArrowVisibility();
            }
            
            function updateArrowVisibility() {
                if (currentVideoIndex === 0) {
                    watchArrowLeft.style.opacity = '0.3';
                    watchArrowLeft.style.pointerEvents = 'none';
                } else {
                    watchArrowLeft.style.opacity = '1';
                    watchArrowLeft.style.pointerEvents = 'auto';
                }
                
                if (currentVideoIndex >= totalVideos - 1) {
                    watchArrowRight.style.opacity = '0.3';
                    watchArrowRight.style.pointerEvents = 'none';
                } else {
                    watchArrowRight.style.opacity = '1';
                    watchArrowRight.style.pointerEvents = 'auto';
                }
            }
            
            function scrollToVideo(index) {
                const cards = watchCarousel.querySelectorAll('.video-card');
                if (cards[index]) {
                    cards[index].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                    currentVideoIndex = index;
                    updateArrowVisibility();
                }
            }
            
            // Listen Mode Functions
            function enterListenMode() {
                listenModeActive = true;
                
                // Trigger transition
                listenOverlay.classList.add('active');
                heroBg.classList.add('listen-mode-blur');
                hudPanel.classList.add('listen-mode-blur');
                
                // Prevent body scroll
                document.body.style.overflow = 'hidden';
            }
            
            function exitListenMode() {
                listenModeActive = false;
                
                listenOverlay.classList.remove('active');
                heroBg.classList.remove('listen-mode-blur');
                hudPanel.classList.remove('listen-mode-blur');
                
                // Restore body scroll
                document.body.style.overflow = '';
            }
            
            // Watch Mode Functions
            async function enterWatchMode() {
                watchModeActive = true;
                
                // Load videos if not loaded
                if (!videosLoaded) {
                    const videos = await fetchYouTubeVideos();
                    renderVideos(videos);
                    videosLoaded = true;
                }
                
                // Trigger transition
                watchOverlay.classList.add('active');
                heroBg.classList.add('watch-mode-blur');
                hudPanel.classList.add('watch-mode-blur');
                
                // Prevent body scroll
                document.body.style.overflow = 'hidden';
            }
            
            function exitWatchMode() {
                watchModeActive = false;
                
                watchOverlay.classList.remove('active');
                heroBg.classList.remove('watch-mode-blur');
                hudPanel.classList.remove('watch-mode-blur');
                
                // Restore body scroll
                document.body.style.overflow = '';
            }
            
            // Video Modal Functions
            let videoModal = null;
            
            function createVideoModal() {
                if (videoModal) return videoModal;
                
                const modal = document.createElement('div');
                modal.className = 'video-modal';
                modal.innerHTML = `
                    <div class="video-modal-content">
                        <iframe id="videoPlayer" frameborder="0" allowfullscreen allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
                    </div>
                `;
                document.body.appendChild(modal);
                
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeVideoModal();
                    }
                });
                
                videoModal = modal;
                return modal;
            }
            
            function openVideoModal(videoId) {
                const modal = createVideoModal();
                const iframe = modal.querySelector('#videoPlayer');
                iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                modal.classList.add('active');
            }
            
            function closeVideoModal() {
                if (!videoModal) return;
                const iframe = videoModal.querySelector('#videoPlayer');
                iframe.src = '';
                videoModal.classList.remove('active');
            }
            
            // Event Listeners
            // Trigger button
            listenTrigger.addEventListener('click', function(e) {
                e.stopPropagation();
                enterListenMode();
            });
            
            // Close button
            listenClose.addEventListener('click', function(e) {
                e.stopPropagation();
                exitListenMode();
            });
            
            // Click outside to close (but not on the embed itself)
            listenOverlay.addEventListener('click', function(e) {
                if (e.target === listenOverlay) {
                    exitListenMode();
                }
            });
            
            // Watch Mode event listeners
            watchTrigger.addEventListener('click', function(e) {
                e.stopPropagation();
                enterWatchMode();
            });
            
            watchClose.addEventListener('click', function(e) {
                e.stopPropagation();
                exitWatchMode();
            });
            
            watchOverlay.addEventListener('click', function(e) {
                if (e.target === watchOverlay) {
                    exitWatchMode();
                }
            });
            
            // Arrow navigation
            watchArrowLeft.addEventListener('click', function(e) {
                e.stopPropagation();
                if (currentVideoIndex > 0) {
                    scrollToVideo(currentVideoIndex - 1);
                }
            });
            
            watchArrowRight.addEventListener('click', function(e) {
                e.stopPropagation();
                if (currentVideoIndex < totalVideos - 1) {
                    scrollToVideo(currentVideoIndex + 1);
                }
            });
            
            // ESC key to close both modes and video modal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' || e.key === 'Esc') {
                    if (videoModal && videoModal.classList.contains('active')) {
                        closeVideoModal();
                    } else if (listenModeActive) {
                        exitListenMode();
                    } else if (watchModeActive) {
                        exitWatchMode();
                    }
                }
            });
            
            // Subtle parallax on hero image
            let ticking = false;
            window.addEventListener('scroll', function() {
              if (!ticking) {
                window.requestAnimationFrame(function() {
                  const scrolled = window.pageYOffset;
                  const parallax = scrolled * 0.15; // Very subtle movement
                  if (heroBg) {
                    heroBg.style.transform = `translateY(${parallax}px) scale(1.02)`;
                  }
                  ticking = false;
                });
                ticking = true;
              }
            });
        });
        </script>
    </div>

    <!-- Listen Mode Overlay -->
    <div class="listen-mode-overlay" id="listenModeOverlay">
        <button class="listen-mode-close" id="listenModeClose">✕</button>
        <div class="listen-mode-content" id="listenModeContent">
            <div class="listen-mode-card">
                <iframe data-testid="embed-iframe" src="https://open.spotify.com/embed/artist/08nIFJLOyYWc5eWJCa4S8X?utm_source=generator" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
            </div>
            <div class="smart-link-card">
                <h3 class="smart-link-heading">Listen Everywhere</h3>
                <iframe width="100%" height="150" src="https://odesli.co/embed/?url=https%3A%2F%2Falbum.link%2Fi%2F1846114882&theme=dark" frameBorder="0" allowfullscreen sandbox="allow-same-origin allow-scripts allow-presentation allow-popups allow-popups-to-escape-sandbox" allow="clipboard-read; clipboard-write"></iframe>
            </div>
        </div>
    </div>

    <!-- Watch Mode Overlay -->
    <div class="watch-mode-overlay" id="watchModeOverlay">
        <button class="watch-mode-close" id="watchModeClose">✕</button>
        <button class="watch-arrow watch-arrow-left" id="watchArrowLeft">‹</button>
        <button class="watch-arrow watch-arrow-right" id="watchArrowRight">›</button>
        <div class="watch-mode-content" id="watchModeContent">
            <div class="watch-loading">Loading videos...</div>
            <div class="watch-carousel" id="watchCarousel">
                <!-- Videos will be injected here by JS -->
            </div>
        </div>
    </div>

    <script>
    // Minimal mode toggle for clean screenshots/sharing
    const toggleBtn = document.getElementById('minimalToggle');
    const hudPanel = document.querySelector('.hud-panel');
    const spotifyWrap = document.querySelector('.spotify-toggle-wrap');
    let minimalMode = localStorage.getItem('minimalMode') === 'true';
    
    function applyMinimalMode(minimal) {
      minimalMode = minimal;
      localStorage.setItem('minimalMode', minimal);
      if (minimal) {
        hudPanel.classList.add('minimal-hidden');
        if (spotifyWrap) spotifyWrap.classList.add('minimal-hidden');
        toggleBtn.classList.add('active');
      } else {
        hudPanel.classList.remove('minimal-hidden');
        if (spotifyWrap) spotifyWrap.classList.remove('minimal-hidden');
        toggleBtn.classList.remove('active');
      }
    }
    
    // Apply saved state
    applyMinimalMode(minimalMode);
    
    // Toggle button click
    toggleBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      applyMinimalMode(!minimalMode);
    });
    
    // Keyboard shortcut: M key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'm' || e.key === 'M') {
        applyMinimalMode(!minimalMode);
      }
    });
    
    // Email capture form
    const emailForm = document.getElementById('emailForm');
    const emailInput = document.getElementById('emailInput');
    emailForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const email = emailInput.value.trim();
      if (email) {
        // Store email (you can later integrate with Mailchimp, ConvertKit, etc.)
        console.log('Email captured:', email);
        // Show success feedback
        emailInput.value = '';
        emailInput.placeholder = 'You\'re in. ✓';
        setTimeout(function() {
          emailInput.placeholder = 'Stay tapped in.';
        }, 3000);
        // TODO: Send to your email service (Mailchimp, ConvertKit, etc.)
      }
    });
    </script>

    <script>
    (function(){
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if(prefersReduced){
            document.querySelectorAll('.reveal').forEach(el => el.classList.add('visible'));
            return;
        }
        const obs = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if(entry.isIntersecting){
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.15, rootMargin: '0px 0px -10% 0px' });
        document.querySelectorAll('.reveal').forEach(el => obs.observe(el));
    })();
    </script>

</body>
</html>
