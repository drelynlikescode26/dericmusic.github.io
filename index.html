<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Deric â€” Official</title>
    <meta property="og:title" content="Deric â€” Official">
    <meta property="og:site_name" content="Deric">
    <meta name="twitter:title" content="Deric â€” Official">
    <meta property="og:description" content="Producer // Artist // Visionary">
    <meta name="twitter:description" content="Producer // Artist // Visionary">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="hero.css">
    <link rel="stylesheet" href="css/listen-portal.css">
    <link rel="stylesheet" href="css/hero-refresh.css">
    <link rel="stylesheet" href="css/hero-video.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
</head>
<body>

    <section class="hero">
        <div class="hero-media">
            <video
                class="hero-video"
                autoplay
                muted
                loop
                playsinline
                preload="metadata"
                poster="assets/hero/hero-poster.jpg"
            >
                <source src="assets/hero/glass%208%20sec%20loop.mov" type="video/quicktime" />
            </video>
            <div class="hero-overlay"></div>
        </div>
        <div class="grain-overlay"></div>
        <div class="hero-content">
            <!-- Minimal Cinematic Hero -->
            <div class="hero-refresh">
                <div class="hero-center">
                    <!-- Identity Block -->
                    <div class="hero-identity">
                        <h1 class="hero-name">DERIC</h1>
                        <div class="hero-subline">Singer â€¢ Songwriter â€¢ Artist</div>
                        
                        <!-- Social Icons -->
                        <div class="hero-social">
                            <a href="https://instagram.com/envyderic" target="_blank" rel="noopener noreferrer" aria-label="Instagram" title="Instagram">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="https://twitter.com" target="_blank" rel="noopener noreferrer" aria-label="Twitter" title="Twitter">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="https://youtube.com/@envyderic" target="_blank" rel="noopener noreferrer" aria-label="YouTube" title="YouTube">
                                <i class="fab fa-youtube"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Portal Buttons -->
                    <div class="hero-portals">
                        <button class="portal-button" id="open-listen-portal" aria-label="Open Listen Portal">
                            <i class="fab fa-spotify"></i>
                            Listen
                        </button>
                        <button class="portal-button" id="open-watch-portal" aria-label="Open Watch Portal">
                            <i class="fab fa-youtube"></i>
                            Watch
                        </button>
                    </div>
                    
                    <!-- Stay Tapped In CTA -->
                    <button class="stay-tapped-pill" id="open-email" aria-haspopup="dialog" aria-controls="emailModal">
                        Stay tapped in
                    </button>
                </div>
            </div>
            
            <!-- Email Modal -->
            <div class="email-modal" id="emailModal" hidden>
                <div class="email-card" role="dialog" aria-modal="true" aria-label="Stay tapped in">
                    <button class="email-close" id="close-email" aria-label="Close">âœ•</button>
                    <div class="email-title">Stay tapped in</div>
                    <form class="email-form" id="heroEmailForm">
                        <input type="email" class="email-input" id="heroEmailInput" placeholder="Your email" required aria-label="Email address">
                        <button type="submit" class="email-submit">â†’</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Release Section -->
    <div class="featured-release" id="featuredRelease">
        <div class="featured-release-card">
            <button class="featured-release-close" id="dismiss-featured-release" aria-label="Dismiss Latest Release">âœ•</button>
            <div class="featured-release-cover">
                <img id="featured-cover" src="" alt="Latest Release">
            </div>
            <div class="featured-release-info">
                <div class="featured-release-label">Latest Release</div>
                <h2 id="featured-title">Loading...</h2>
                <div id="featured-date" class="featured-release-date"></div>
                <div id="featured-mood" class="featured-release-mood"></div>
                <a id="featured-listen" href="#" class="featured-release-btn" target="_blank" rel="noopener">
                    Listen on Spotify
                </a>
            </div>
        </div>
    </div>

        <script>
        // Wait for DOM to fully load
        document.addEventListener('DOMContentLoaded', function() {
            // YouTube API Configuration
            const YOUTUBE_API_KEY = 'AIzaSyCsbg4IqmFkgteGXWOTu5B4N13QXh2ugkQ';
            const CHANNEL_ID = 'UCvMVDYpt5z-5MCPyIMtlT9A';
            const CACHE_KEY = 'youtube_videos_cache';
            const CACHE_DURATION = 3600000; // 1 hour in milliseconds
            
            // Elements
            const listenTrigger = document.getElementById('listenTrigger');
            const listenOverlay = document.getElementById('listenModeOverlay');
            const listenContent = document.getElementById('listenModeContent');
            const listenClose = document.getElementById('listenModeClose');
            const watchTrigger = document.getElementById('watchTrigger');
            const watchOverlay = document.getElementById('watchModeOverlay');
            const watchContent = document.getElementById('watchModeContent');
            const watchClose = document.getElementById('watchModeClose');
            const watchFeaturedPlayer = document.getElementById('watchFeaturedPlayer');
            const watchThumbnailsScroll = document.getElementById('watchThumbnailsScroll');
            const heroBg = document.querySelector('.hero-bg');
            const hudPanel = document.querySelector('.hud-panel');
            
            let listenModeActive = false;
            let watchModeActive = false;
            let videosLoaded = false;
            let currentVideoIndex = 0;
            let totalVideos = 0;
            
            // YouTube API Functions
            function getCachedVideos() {
                try {
                    const cache = localStorage.getItem(CACHE_KEY);
                    if (!cache) return null;
                    
                    const { timestamp, videos } = JSON.parse(cache);
                    const now = Date.now();
                    
                    if (now - timestamp < CACHE_DURATION) {
                        return videos;
                    }
                    return null;
                } catch (e) {
                    return null;
                }
            }
            
            function cacheVideos(videos) {
                try {
                    const cache = {
                        timestamp: Date.now(),
                        videos: videos
                    };
                    localStorage.setItem(CACHE_KEY, JSON.stringify(cache));
                } catch (e) {
                    console.warn('Could not cache videos');
                }
            }
            
            async function fetchYouTubeVideos() {
                // Check cache first
                const cached = getCachedVideos();
                if (cached) {
                    return cached;
                }
                
                // Fetch from API (get more results to filter)
                const url = `https://www.googleapis.com/youtube/v3/search?key=${YOUTUBE_API_KEY}&channelId=${CHANNEL_ID}&part=snippet,id&order=date&maxResults=15&type=video`;
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error('API request failed');
                    
                    const data = await response.json();
                    const videos = data.items.map(item => ({
                        id: item.id.videoId,
                        title: item.snippet.title,
                        thumbnail: item.snippet.thumbnails.high.url,
                        publishedAt: item.snippet.publishedAt
                    }));
                    
                    // Get video statistics and duration to filter out Shorts
                    const videoIds = videos.map(v => v.id).join(',');
                    const statsUrl = `https://www.googleapis.com/youtube/v3/videos?key=${YOUTUBE_API_KEY}&id=${videoIds}&part=statistics,contentDetails`;
                    const statsResponse = await fetch(statsUrl);
                    const statsData = await statsResponse.json();
                    
                    // Filter out Shorts (videos under 90 seconds) and merge stats
                    const filteredVideos = [];
                    videos.forEach((video, index) => {
                        const videoData = statsData.items[index];
                        if (videoData) {
                            // Parse duration (ISO 8601 format like PT1M30S)
                            const duration = videoData.contentDetails.duration;
                            const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
                            const hours = parseInt(match[1] || 0);
                            const minutes = parseInt(match[2] || 0);
                            const seconds = parseInt(match[3] || 0);
                            const totalSeconds = hours * 3600 + minutes * 60 + seconds;
                            
                            // Only include videos 90 seconds or longer (exclude Shorts)
                            if (totalSeconds >= 90) {
                                filteredVideos.push(video);
                            }
                        }
                    });
                    
                    // Return only first 5 filtered videos
                    const finalVideos = filteredVideos.slice(0, 5);
                    cacheVideos(finalVideos);
                    return finalVideos;
                } catch (error) {
                    console.error('Failed to fetch YouTube videos:', error);
                    return [];
                }
            }
            
            function formatTimeAgo(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const seconds = Math.floor((now - date) / 1000);
                
                if (seconds < 60) return 'just now';
                if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
                if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
                if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;
                if (seconds < 2592000) return `${Math.floor(seconds / 604800)}w ago`;
                return `${Math.floor(seconds / 2592000)}mo ago`;
            }
            
            function renderVideos(videos) {
                totalVideos = videos.length;
                currentVideoIndex = 0;
                
                if (videos.length === 0) {
                    watchFeaturedPlayer.innerHTML = '<div class="watch-loading">No videos available</div>';
                    return;
                }
                
                // Load first video in featured player
                loadFeaturedVideo(videos[0].id);
                
                // Render thumbnails
                watchThumbnailsScroll.innerHTML = '';
                videos.forEach((video, index) => {
                    const thumbnail = document.createElement('div');
                    thumbnail.className = `watch-thumbnail-card ${index === 0 ? 'active' : ''}`;
                    thumbnail.dataset.index = index;
                    thumbnail.innerHTML = `
                        <img src="${video.thumbnail}" alt="${video.title}">
                        <div class="watch-thumbnail-title">${video.title}</div>
                    `;
                    
                    thumbnail.addEventListener('click', () => {
                        // Update active state
                        document.querySelectorAll('.watch-thumbnail-card').forEach(t => t.classList.remove('active'));
                        thumbnail.classList.add('active');
                        // Load video in featured player
                        loadFeaturedVideo(video.id);
                        currentVideoIndex = index;
                    });
                    
                    watchThumbnailsScroll.appendChild(thumbnail);
                });
            }
            
            function loadFeaturedVideo(videoId) {
                watchFeaturedPlayer.innerHTML = `
                    <iframe 
                        src="https://www.youtube-nocookie.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1"
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>
                `;
            }
            
            // Listen Mode Functions
            function enterListenMode() {
                listenModeActive = true;
                
                // Trigger transition
                listenOverlay.classList.add('active');
                heroBg.classList.add('listen-mode-blur');
                hudPanel.classList.add('listen-mode-blur');
                
                // Prevent body scroll
                document.body.style.overflow = 'hidden';
            }
            
            function exitListenMode() {
                listenModeActive = false;
                
                listenOverlay.classList.remove('active');
                heroBg.classList.remove('listen-mode-blur');
                hudPanel.classList.remove('listen-mode-blur');
                
                // Restore body scroll
                document.body.style.overflow = '';
            }
            
            // Watch Mode Functions
            async function enterWatchMode() {
                watchModeActive = true;
                
                // Load videos if not loaded
                if (!videosLoaded) {
                    const videos = await fetchYouTubeVideos();
                    renderVideos(videos);
                    videosLoaded = true;
                }
                
                // Trigger transition
                watchOverlay.classList.add('active');
                heroBg.classList.add('watch-mode-blur');
                hudPanel.classList.add('watch-mode-blur');
                
                // Prevent body scroll
                document.body.style.overflow = 'hidden';
            }
            
            function exitWatchMode() {
                watchModeActive = false;
                
                watchOverlay.classList.remove('active');
                heroBg.classList.remove('watch-mode-blur');
                hudPanel.classList.remove('watch-mode-blur');
                
                // Restore body scroll
                document.body.style.overflow = '';
            }
            
            // Video Modal Functions
            let videoModal = null;
            
            function createVideoModal() {
                if (videoModal) return videoModal;
                
                const modal = document.createElement('div');
                modal.className = 'video-modal';
                modal.innerHTML = `
                    <div class="video-modal-content">
                        <iframe id="videoPlayer" frameborder="0" allowfullscreen allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
                    </div>
                `;
                document.body.appendChild(modal);
                
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeVideoModal();
                    }
                });
                
                videoModal = modal;
                return modal;
            }
            
            function openVideoModal(videoId) {
                const modal = createVideoModal();
                const iframe = modal.querySelector('#videoPlayer');
                iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
                modal.classList.add('active');
            }
            
            function closeVideoModal() {
                if (!videoModal) return;
                const iframe = videoModal.querySelector('#videoPlayer');
                iframe.src = '';
                videoModal.classList.remove('active');
            }
            
            // Event Listeners
            // Trigger button
            listenTrigger.addEventListener('click', function(e) {
                e.stopPropagation();
                enterListenMode();
            });
            
            // Close button
            listenClose.addEventListener('click', function(e) {
                e.stopPropagation();
                exitListenMode();
            });
            
            // Click outside to close (but not on the embed itself)
            listenOverlay.addEventListener('click', function(e) {
                if (e.target === listenOverlay) {
                    exitListenMode();
                }
            });
            
            // Watch Mode event listeners
            watchTrigger.addEventListener('click', function(e) {
                e.stopPropagation();
                enterWatchMode();
            });
            
            watchClose.addEventListener('click', function(e) {
                e.stopPropagation();
                exitWatchMode();
            });
            
            watchOverlay.addEventListener('click', function(e) {
                if (e.target === watchOverlay) {
                    exitWatchMode();
                }
            });
            
            // ESC key to close both modes and video modal
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' || e.key === 'Esc') {
                    if (videoModal && videoModal.classList.contains('active')) {
                        closeVideoModal();
                    } else if (listenModeActive) {
                        exitListenMode();
                    } else if (watchModeActive) {
                        exitWatchMode();
                    }
                }
            });
            
            // Expose enterWatchMode globally for external scripts
            window.enterWatchMode = enterWatchMode;
            
            // Subtle parallax on hero image
            let ticking = false;
            window.addEventListener('scroll', function() {
              if (!ticking) {
                window.requestAnimationFrame(function() {
                  const scrolled = window.pageYOffset;
                  const parallax = scrolled * 0.15; // Very subtle movement
                  if (heroBg) {
                    heroBg.style.transform = `translateY(${parallax}px) scale(1.02)`;
                  }
                  ticking = false;
                });
                ticking = true;
              }
            });
        });
        </script>
    </div>

    <!-- Watch Mode Overlay - Immersive Video Portal -->
    <div class="watch-mode-overlay" id="watchModeOverlay">
        <button class="watch-mode-close" id="watchModeClose">âœ•</button>
        
        <div class="watch-mode-content" id="watchModeContent">
            <!-- Featured Video Player -->
            <div class="watch-featured-player" id="watchFeaturedPlayer">
                <div class="watch-loading">Loading videos...</div>
            </div>
            
            <!-- Video Thumbnails -->
            <div class="watch-thumbnails-section">
                <div class="watch-thumbnails-scroll" id="watchThumbnailsScroll">
                    <!-- Thumbnails will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <script>
    // Email capture form
    const emailForm = document.getElementById('emailForm');
    const emailInput = document.getElementById('emailInput');
    if (emailForm && emailInput) {
      emailForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const email = emailInput.value.trim();
        if (email) {
          // Store email (you can later integrate with Mailchimp, ConvertKit, etc.)
          console.log('Email captured:', email);
          // Show success feedback
          emailInput.value = '';
          emailInput.placeholder = 'You\'re in. âœ“';
          setTimeout(function() {
            emailInput.placeholder = 'Stay tapped in.';
          }, 3000);
          // TODO: Send to your email service (Mailchimp, ConvertKit, etc.)
        }
      });
    }
    </script>

    <script>
    (function(){
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if(prefersReduced){
            document.querySelectorAll('.reveal').forEach(el => el.classList.add('visible'));
            return;
        }
        const obs = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if(entry.isIntersecting){
                    entry.target.classList.add('visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.15, rootMargin: '0px 0px -10% 0px' });
        document.querySelectorAll('.reveal').forEach(el => obs.observe(el));
    })();
    </script>

    <script src="js/featuredRelease.js"></script>
    <script src="js/listen-portal.js"></script>
    <script src="js/hero-refresh.js"></script>
    <script src="js/hero-video.js"></script>

    <!-- Listen Portal Modal -->
    <div id="listen-portal" class="listen-portal-overlay" hidden>
        <div class="listen-portal-card">
            <button class="listen-portal-close" aria-label="Close" title="Close (ESC)">âœ•</button>
            
            <div class="listen-portal-cover">
                <img id="portal-cover" src="" alt="Album Cover">
            </div>
            
            <div class="listen-portal-info">
                <div class="listen-portal-label">Latest Release</div>
                <h2 id="portal-title" class="listen-portal-title">Loading...</h2>
                <div id="portal-date" class="listen-portal-date"></div>
            </div>
            
            <div class="listen-portal-buttons">
                <a id="portal-btn-spotify" href="#" class="listen-portal-btn listen-portal-btn-spotify" target="_blank" rel="noopener" hidden>
                    <span class="listen-portal-btn-icon"><i class="fab fa-spotify"></i></span>
                    <span>Listen on Spotify</span>
                </a>
                <a id="portal-btn-apple" href="#" class="listen-portal-btn listen-portal-btn-apple" target="_blank" rel="noopener" hidden>
                    <span class="listen-portal-btn-icon"><i class="fab fa-apple"></i></span>
                    <span>Listen on Apple Music</span>
                </a>
                <a id="portal-btn-all" href="#" class="listen-portal-btn listen-portal-btn-all" target="_blank" rel="noopener" hidden>
                    <span class="listen-portal-btn-icon">ðŸŽµ</span>
                    <span>All Platforms</span>
                </a>
            </div>
        </div>
    </div>

</body>
</html>
